#!/usr/bin/make -f

#export DH_VERBOSE=1
export PACKAGE = ortho4xp
export VERSION := $(shell dpkg-parsechangelog | egrep '^Version:' | cut -f 2 -d ' ')

# Let's keep our source tree clean
export PYTHONDONTWRITEBYTECODE=1

%:
	dh $@ --with python3

override_dh_auto_build:
	mkdir -p debian/build

	# Build Triangle4XP
	gcc -o debian/build/Triangle4XP Utils/Triangle4XP.c -lm
	chmod a+x debian/build/Triangle4XP

	# Extract DSFTool
	unzip -d debian/build -j 3rdParty/xptools_lin_15-3.zip tools/DSFTool
	chmod a+x debian/build/DSFTool

	# Copy and patch Ortho4XP.py
	cp Ortho4XP_devel.py debian/build/Ortho4XP.py
	sed -i "s|^\s*version\s*=.*|version = '$(VERSION)'|" debian/build/Ortho4XP.py
	patch debian/build/Ortho4XP.py debian/ortho4xp.path.patch
	chmod a+x debian/build/Ortho4XP.py

override_dh_install:
	# Install
	dh_install

override_dh_clean:
	# Clean
	dh_clean

	# Our mess
	rm -rf debian/build

